## 1. Введение
Современная клиническая практика опирается на доказательные рекомендации, публикуемые в виде PDF/DOCX и научных статей, однако формат, объём и частота обновлений этих документов делают ручной поиск и интерпретацию крайне трудозатратными, что повышает вероятность ошибок и снижает скорость принятия решений в повседневной работе врачей.  
В этих условиях критически востребован конвейер, который воспроизводимо преобразует разнородные источники в унифицированные шаблоны, далее в RDF/TTL и граф знаний, а затем генерирует объяснимые планы лечения с прозрачной трассируемостью каждого элемента до версии источника и страницы, доступные через интеграцию в существующее ПО для врачей без отдельной аутентификации в модуле.  
Предлагаемый модуль реализует связную цепочку «документ → шаблон → RDF/TTL → граф знаний → генерация плана лечения ЯМ → экспертная валидация → публикация через REST‑API», фиксируя версии артефактов и события аудита на каждом этапе для регуляторной проверяемости и восстановления причинно‑следственных связей в клинических решениях.  
Целью является спроектировать и описать архитектуру, процессы и интерфейсы модуля, а также регламентировать принципы качества, безопасности и версионирования, чтобы обеспечить воспроизводимость результатов, согласованность с клиническими рекомендациями и удобную интеграцию в рабочие процессы врачей.  
Практическая значимость выражается в сокращении времени подготовки плана лечения, снижении вариативности трактовок, повышении объяснимости и управляемости знаний за счёт единого онтологического слоя и графовых представлений, при этом соблюдение требований к программной среде обеспечивает применимость в продуктивных контурах без использования несертифицированного ПО.

## 2. Описание проблемы, цели, ограничения и приоритетные клиентские пути

### 2.1 Проблемы текущего состояния (AS IS)
- Существующая практика подразумевает ручной поиск рекомендаций и чтение PDF/DOCX с неоднородной структурой, где таблицы и вложенные примечания часто не размечены, что препятствует автоматической нормализации и повторному использованию знаний в цифровых процессах.  
- Отсутствие единого онтологического слоя и графа знаний приводит к разрыву между нозологиями, критериями применимости, методами лечения и услугами, из‑за чего невозможно формально проверять полноту и актуальность решений и оперативно выявлять противоречия при обновлении источников.  
- Не хватает прослеживаемости: врач не видит, какой именно фрагмент документа, версия шаблона или ребро графа лежит в основании конкретного шага плана, а экспертные правки не замыкают цикл улучшения знаний и дообучения языковой модели.  
- Отсутствует регламентированный конвейер версионирования шаблонов, триплетов, графа и итоговых планов с журналированием, что повышает риски задержек при обновлениях и рассинхронизации между источниками, представлениями и выдачей через API.

### 2.2 Цели концепции
- Основная цель — создать модуль, автоматически переводящий клинические документы в унифицированные шаблоны и RDF/TTL, формирующий граф знаний и использующий собственную языковую модель для генерации объяснимых планов лечения с экспертной валидацией и публикацией через REST‑API внутри существующего ПО для врачей.  
- Ключевые задачи включают: разработку формата шаблонов и валидаторов заполненности; конвертацию в триплеты с сохранением ссылок на источник и страницу; загрузку и индексацию графа; генерацию планов на основе релевантных подграфов со step‑by‑step объяснимостью; инструменты экспертного редактирования узлов/рёбер и текста плана; версионный аудит всех артефактов; проектирование REST‑контрактов и нефункциональных требований по производительности, надёжности и безопасности.  
- Целевые эффекты: сокращение времени формирования планов, повышение воспроизводимости и объяснимости, снижение вариативности трактовок за счёт единой онтологии, управляемость качеством и рисками, а также предсказуемая интеграция без дублирования аутентификации пользователей на стороне модуля.

### 2.3 Ограничения концепции
- Технологические ограничения: модуль интегрируется как компонент базовой системы и не осуществляет отдельную пользовательскую аутентификацию, полагаясь на машинные учётные записи и доверенный периметр; в продуктивной среде исключается несертифицированный open source, а стек и процессы релиза соответствуют регламентам среды эксплуатации.  
- Правовые ограничения: обработка медданных требует соблюдения ФЗ‑152 и стандартов для СППВР, при этом автоматически сгенерированные планы имеют рекомендательный статус и подлежат утверждению врачом‑экспертом до публикации в рабочие контуры.  
- Организационные ограничения: объём первичного внедрения определяется ресурсами, сроками и приоритетными нозологиями, что влияет на глубину интеграций, SLA правок и частоту релизов, закреплённые в регламенте взаимодействия ролей.  
- Ограничения точности и полноты: качество исходных документов, сложность нормализации и риск галлюцинаций ЯМ требуют итеративной настройки валидаторов, пополнения онтологии и циклового дообучения по экспертным правкам с обязательной трассируемостью изменений.

### 2.4 Приоритетные клиентские пути
- 2.4.1 Врач‑пользователь в системе  
  AS IS: врач вручную ищет и интерпретирует разнородные документы с неодинаковой структурой и терминологией, тратит значительное время и сталкивается с вариативностью трактовок без гарантии актуальности.  
  TO BE: врач по API базовой системы получает структурированный план для указанной нозологии и профиля пациента с обоснованиями, ссылками на источники и фрагментом релевантного подграфа, не покидая основной рабочий интерфейс.  
  Ключевые выгоды: экономия времени, повышение обоснованности решений, единая терминология и навигация по сложным правилам на основе онтологических связей.  

- 2.4.2 Врач‑эксперт (валидация и улучшение знаний)  
  AS IS: экспертные замечания остаются вне общего контура данных, не переводятся в обновление онтологии и не улучшают поведение языковой модели.  
  TO BE: эксперт просматривает узлы/рёбра и текст плана, вносит правки, утверждает версии и инициирует обратную интеграцию правок в обучающий контур ЯМ для повышения точности и полноты.  
  Ключевые выгоды: замыкание контура качества, уменьшение галлюцинаций и наращивание проверенной базы знаний в виде версионируемого графа.  

- 2.4.3 Администратор данных (обновления и контроль)  
  AS IS: отсутствует унифицированный механизм загрузки пакетов рекомендаций, контроля статусов парсинга, просмотра версий и комплексного аудита.  
  TO BE: администратор загружает пакеты, отслеживает статусы, видит журналы и релейшены «шаблон → триплеты → граф → планы», формирует релизные отчёты соответствия и запускает переиндексацию.  
  Ключевые выгоды: прозрачность, управляемость жизненного цикла знаний и воспроизводимость релизов.  

- 2.4.4 Интеграционная роль базовой системы  
  AS IS: отсутствуют стабильные эндпоинты модуля и предсказуемые форматы выдачи для встраивания в рабочие места врачей.  
  TO BE: базовая система вызывает версионированные REST‑эндпоинты, получает структурированный JSON/HTML и фрагменты графа, обеспечивая единый пользовательский опыт без дублирования аутентификации.  
  Ключевые выгоды: упрощённая интеграция, единообразие представления и снижение TCO внедрения.  

### 2.5 SMART‑критерии целей системы
- Specific: реализовать модуль преобразования клинических документов в шаблоны и граф знаний с генерацией объяснимых планов и публикацией через REST‑API в базовую систему для врачей.  
- Measurable: покрыть не менее 10 целевых нозологий в первичном выпуске, обеспечить ≥80% заполненности обязательных полей шаблонов, время ответа поискового API ≤1–3 с, долю планов без правок эксперта ≥60% на эталонных кейсах.  
- Achievable: достижимо в рамках 7‑месячного плана с итерациями по шаблонам, онтологии, графу, ЯМ и интеграции при согласованном стеке и среде.  
- Relevant: адресует потребности врачей и администраторов в объяснимых и актуальных рекомендациях, снижая нагрузку и риск ошибок за счёт автоматизации и единообразия.  
- Time‑bound: релиз v1.0 к окончанию 7‑го месяца с подготовкой пилотной эксплуатации, отчётностью и комплектом документации для защиты.  

## 3. Общее описание архитектуры

### 3.1 Функциональная архитектура
- Процесс 1 «Парсинг и нормализация»: загрузка пакетов, извлечение сущностей (нозология, критерии, методы, услуги, условия, уровни доказательности) и заполнение шаблонов; семантическая валидация выполняется на уровне ЯМ.  
- Процесс 2 «Онтология и граф»: конвертация заполненных шаблонов в RDF/TTL, загрузка в графовую БД, формирование подграфов по нозологиям и индексация связей для быстрых выборок, поиска и визуализаций.  
- Процесс 3 «Генерация и валидация»: ЯМ формирует план лечения со step‑by‑step объяснимостью на основе релевантного подграфа; врач‑эксперт при необходимости редактирует узлы/рёбра и текст, утверждает версию и замыкает контур RLHF.  
- Процесс 4 «Публикация и поиск»: версионированные эндпоинты возвращают структурированный JSON, HTML‑таблицы и фрагменты графа под требования базовой системы и сценарии поиска врачей.  

### 3.2 ИТ‑архитектура (модель C4)
- Контекст: модуль встроен в базовую систему для врачей, взаимодействует с администраторами данных и врачами‑экспертами опосредованно через инструменты верификации; использует собственную ЯМ и внутренние хранилища шаблонов/графа; внешняя аутентификация и маршрутизация прав делегированы базовой системе.  
- Контейнеры: сервис приёма и парсинга; сервис нормализации и проверки заполненности шаблонов; сервис онтологии и графа; сервис генерации планов (ЯМ); сервис публикации и поиска (REST); подсистемы версионирования и аудита; журналирование и мониторинг.  
- Компоненты: экстракторы сущностей, конвертеры в RDF/TTL с сохранением ссылок на источник/страницу, загрузчики в граф, индексаторы подграфов, исполнитель генерации с объяснимостью, редактор экспертных правок и менеджер связности «шаблон → триплеты → граф → план».  
- Код‑уровень: контракты API и схемы DTO, валидаторы заполненности, репозитории реляционного и графового слоёв, профайлинг и кэширование узких мест, ретраи и идемпотентность для устойчивости под нагрузкой.  

### 3.3 Модель данных
- Ключевые сущности: Recommendation (рекомендация, МКБ‑10, ссылки на источники и версии), Criterion (возраст, симптомы, противопоказания, временные рамки, дозы), Method (методы лечения и параметры), Service (услуги/процедуры и коды), GraphNode/GraphEdge (концепты и связи), TreatmentPlan (план с обоснованиями и ссылками), ExpertChange (правки и комментарии).  
- Слои хранения: реляционный слой хранит шаблоны, версии, планы, связи с пользователями и журналами; графовый слой хранит понятийные связи и правила выбора, обеспечивая быстрые подграфы, онтологическую навигацию и трассируемость до источников на уровне узлов и рёбер.  
- Версионирование: восстановление цепочки «план → версия шаблона → узлы/рёбра графа → источник/страница» и сопоставление с релизами для аудита, воспроизводимости и объяснимости.  

### 3.4 Инфраструктура
- Выделенные контуры для API, онтологического слоя/графа и ЯМ‑сервиса; сетевая сегментация; резервное копирование реляционного и графового слоёв; централизованное логирование и мониторинг с ретенцией для аудита.  
- Горизонтальное масштабирование для API и парсинга; отдельное масштабирование вычислительных ресурсов ЯМ, что соответствует требованию отделимости вычислительной части от хранилищ данных и позволяет выдерживать SLA при росте нагрузки.  

### 3.5 Архитектурные принципы
- Разделение ответственности: каждый сервис выполняет строго определённую роль и взаимодействует по стабильным контрактам, что упрощает тестирование и заменяемость компонентов без каскадных изменений.  
- Слабая связанность и устойчивость: взаимодействие через REST и очереди, ретраи, идемпотентность, кэширование и контрольные точки парсинга обеспечивают graceful degradation и предсказуемость поведения при сбоях.  
- Производительность и масштабируемость: индексация подграфов, профилирование тяжёлых запросов, асинхронная обработка и многоуровневый кэш снижают латентность и повышают throughput под реальную загрузку.  
- Безопасность и соответствие: требования регламентов учитываются на этапе проектирования, релизного контроля и эксплуатации; неизменяемые отчёты и журналы обеспечивают аудит и доказуемость процессов.

## 4. Связность и интеграция
Архитектура модуля предполагает двунаправленные интеграции: входящие — с источниками клинических данных (официальные рекомендации, согласованные публикации), исходящие — с базовой системой для врачей через версионированные REST‑эндпоинты, возвращающие планы лечения, их объяснения и релевантные срезы графа знаний.  
Интеграционный контур спроектирован с учётом устойчивости, управляемых лимитов, кэширования типовых ответов, журналирования и предсказуемых SLA, чтобы обеспечивать стабильную работу при обновлениях рекомендаций и росте нагрузки.  

### 4.1 Интеграции с внешними системами
- Базовая система для врачей вызывает REST‑эндпоинты модуля без дублирования пользовательской аутентификации, передавая служебные токены/заголовки доверенного периметра и идентификаторы запросов для трассировки и корреляции логов на всём пути запроса.  
- Источники клинических данных поставляются в согласованных пакетах (PDF/DOCX/HTML и вложения) с метаданными (дата, версия, ссылка на источник/страницу), после чего проходят парсинг, нормализацию в шаблоны и конвертацию в RDF/TTL с фиксацией цепочки происхождения каждого утверждения.  
- Встроенные механизмы очередей и лимитирования выравнивают пики входящего трафика, а многоуровневое кэширование (на уровне запросов, агрегатов и фрагментов графа) сокращает задержки повторных вызовов и снижает нагрузку на графовую БД.  
- При временной недоступности источников модуль переходит в деградированный режим: отдаёт валидированные и помеченные версии ранее опубликованных планов/фрагментов графа, сигнализируя базовой системе статус свежести и доступности подложенных данных.  
- Политики ретраев и backoff применяются асимметрично: для критических рабочих запросов — короткие повторы и падение в кэш, для пакетной загрузки рекомендаций — расширенные окна повторов с контрольными точками (checkpointing) и идемпотентностью на уровне пакетов.  

Примеры интеграционных сценариев (концептуально):  
- Поиск и получение плана лечения: базовая система выполняет GET‑запрос с параметрами нозологии/профиля пациента и получает JSON/HTML плюс идентификаторы узлов/рёбер подграфа для клиентской визуализации.  
- Обновление рекомендаций: администратор отправляет пакет через загрузочный эндпоинт; модуль распаковывает, парсит, валидирует заполненность шаблонов, строит триплеты и загружает в граф, публикуя журнал и релизный отчёт.  

### 4.2 Стандарты обмена данными
- REST — основной стиль интеграций; ответы в JSON/HTML, при необходимости — отдельные представления лонгридов объяснимости и компактных сводок для карточек врача, с явным указанием версии контента и ссылкой на источник/страницу.  
- OpenAPI спецификация описывает контракты и служит единым источником генерации клиентских SDK/валидаторов схем, включая описания параметров фильтрации, пагинации, сортировки и полей трассировки (correlation‑id).  
- Версионирование API через путь вида /api/v1/… обеспечивает обратную совместимость; изменения типов контрактов вносятся минорно с сохранением старых эндпоинтов до окончания переходного периода, о чём сообщается в changelog релиза.  
- Стандартизованы коды ошибок и тело ответа об ошибке: код, категория, человекочитаемое сообщение, correlation‑id, рекомендуемое действие; это ускоряет разбор инцидентов и упрощает интеграционные тесты.  

### 4.3 Исходящие интеграции и API
- Export‑возможности включают выгрузку планов лечения, шаблонов, RDF/TTL‑триплетов, журналов и релизных отчётов со стандартными параметрами фильтрации (период, нозологии, версии), пагинации, сортировки и полями выборочного составления пакетов.  
- Для встраиваемой визуализации предоставляются указатели на фрагменты графа (идентификаторы узлов/рёбер и их атрибуты), чтобы клиентские интерфейсы базовой системы могли безопасно рендерить подграфы без прямого доступа к внутренней структуре БД.  
- Публикуются релизные отчёты качества с агрегированными метриками заполненности шаблонов, корректности связей, доли планов без экспертных правок и перечнем версий артефактов, что упрощает эксплуатационный аудит и контроль соответствия.
  
### 4.4 Схема взаимодействия компонентов
<img width="1395" height="651" alt="image" src="https://github.com/user-attachments/assets/8a736502-bf81-4311-9fcd-cdbaa48fdc7b" />



## 5. Принципы проектирования
Архитектурные принципы фиксируют границы ответственности и технические практики, гарантирующие предсказуемость поведения модуля, его сопровождаемость, производительность и соответствие нормативным требованиям в продуктивной среде.  
Каждый принцип подкреплён конкретными механизмами (контракты, очереди, кэш, ретраи, валидаторы, журналы), которые транслируются в нефункциональные требования и автоматизированные проверки в конвейере релизов.  

### 5.1 Принцип разделения ответственности
- Приём/парсинг — только извлечение структуры и заполненность шаблонов, без семантической валидации; нормализация и объяснимость — на уровне ЯМ, что исключает дублирование логики правил в разных компонентах.  
- Онтология/граф отвечают за связность, верифицируемость и быстрые подграфы; публикация/поиск — за SLA выдачи и форматы для встраивания; версии/аудит — за прослеживаемость и неизменяемые отчёты релизов.  

### 5.2 Принцип слабой связанности
- Компоненты взаимодействуют через REST и асинхронные очереди; внутренние структуры данных не «просачиваются» в контракты, что позволяет независимо развивать и масштабировать сервисы.  
- Событийная связка (журналы обновлений, статусы парсинга/загрузки графа) позволяет базовой системе реагировать на изменения без плотной синхронизации по времени, снижая риск каскадных сбоев.  

### 5.3 Принцип отказоустойчивости и graceful degradation
- Ретраи с экспоненциальным backoff, тайм‑ауты, ограничение параллелизма и резервные ответы из кэша поддерживают доступность пользовательских сценариев при частичной недоступности источников/хранилищ.  
- Контрольные точки в пайплайне парсинга/загрузки и идемпотентные операции предотвращают дубли, обеспечивая корректное возобновление пакетных задач после сбоев.  

### 5.4 Принцип идемпотентности операций
- Повторная обработка одинаковых пакетов и генераций не нарушает целостность: применяются устойчивые идентификаторы и хеши, проверка версий, блокировки на время фиксации артефактов и валидация связей.  
- Эндпоинты экспорта и публикации поддерживают идемпотентные ключи запроса, что позволяет безопасно повторять вызовы интеграторам без риска рассинхронизации.  

### 5.5 Принцип производительности и масштабируемости
- Индексация подграфов по ключевым полям, профилирование горячих маршрутов и асинхронная обработка обеспечивают низкую латентность поиска и генерации планов под заданный SLA.  
- Кэширование на нескольких уровнях (запросы, агрегаты, материализованные представления) и разделённое масштабирование API/парсинга и ЯМ позволяют эффективно использовать ресурсы при росте номенклатуры запросов.  

### 5.6 Принцип безопасности и соответствия стандартам
- Требования СППВР и защиты персональных данных учитываются «по умолчанию» в архитектуре, договорах поставки, релизных практиках и эксплуатационных регламентах.  
- Неизменяемые журналы, релизные отчёты и политики доступа обеспечивают аудит и проверяемость всех этапов жизненного цикла знаний.  

## 6. Информационная безопасность
Информационная безопасность включает нормативные, технические и организационные меры, обеспечивающие законность обработки медданных, устойчивость к инцидентам, прослеживаемость действий и восстановление после сбоев в пределах целевых RPO/RTO.  
Модуль опирается на защищённые каналы передачи, сегментацию сетей, минимизацию прав и централизованное журналирование для соответствия требованиям и поддержания доверенной среды исполнения.  

### 6.1 Нормативные требования
- Применяются требования ГОСТ Р 71671‑2024 (СППВР с ИИ), ПНСТ 872‑2023 (разработка и клинические испытания СППВР), ФЗ‑152 (персональные данные), ФЗ‑149 (информационные системы), а также внутренние стандарты организации.  
- Результаты автоматизированной генерации имеют рекомендательный статус до утверждения врачом‑экспертом и публикуются в рабочие контуры только после валидации и фиксации версии/журналов.  

### 6.2 Технические меры защиты
- Шифрование трафика (TLS), сегментация сетей (API/БД/ЯМ), минимально необходимые права сервисных учёток, хранение секретов во внешнем защищённом хранилище и контроль целостности артефактов.  
- Полное журналирование админских и сервисных действий, ретенция логов, неизменяемые релизные отчёты и мониторинг аномалий обеспечивают аудит и расследование инцидентов.  

### 6.3 Организационные меры
- Роли и регламенты доступа, процедуры релизного контроля, обучение персонала работе с данными и регулярные аудиты соответствия входят в обязательный контур управления.  
- План реагирования на инциденты определяет порядок эскалаций, окна коммуникаций, сценарии локализации и восстановления с контрольными чек‑листами и отчётностью.  

### 6.4 Защита данных
- Принцип минимизации: обрабатываются только необходимые для сценария данные; хранение осуществляется в контролируемой юрисдикции и сегментах, определённых регламентами.  
- Резервное копирование и регулярные тесты восстановления, а также трассируемость доступа/изменений и управляемые сроки хранения обеспечивают целостность и управляемость жизненного цикла данных.  

## 7. Экономическая эффективность
Экономический эффект формируется за счёт автоматизации поиска/интерпретации рекомендаций, стандартизации применения правил и снижения доли экспертных правок благодаря накоплению проверенного графа знаний.  
Дополнительные выгоды — повышение качества клинических решений и снижение операционных рисков в рабочих контурах за счёт версии, аудита и объяснимости.  

### 7.1 Структура затрат на разработку
- Основные статьи: время команды, окружение для БД/графа/REST/ЯМ, мониторинг/логи; архитектура предусматривает последующее масштабирование без изменения базовых контрактов и схем данных.  
- Разделение вычислительных ресурсов ЯМ и слоёв хранения позволяет планировать мощности по независимым профилям нагрузки (онлайн‑поиск, пакетные обновления рекомендаций).  

### 7.2 Экономическое обоснование проекта
- Экономия времени врача при подготовке плана лечения и снижение вариативности трактовок переводятся в прямое сокращение издержек и рост качества обслуживания в рабочих процессах.  
- Объяснимость и трассируемость рекомендаций уменьшают стоимость аудита и разборов инцидентов, повышая доверие к цифровым клиническим процедурам.  

### 7.3 Потенциал внедрения
- Архитектура и контракты спроектированы так, чтобы добавление нозологий и источников не требовало перестройки конвейера: расширяются шаблоны, онтология и граф при сохранении инвариантов API.  
- Согласованные интерфейсы публикации позволяют подключать новые рабочие места и подсистемы без изменений в ядре модуля, ограничиваясь конфигурацией маршрутизации и политик доступа.  

### 7.4 Оценка окупаемости
- Окупаемость достигается за счёт сокращения времени обработки клинических сценариев, уменьшения количества корректировок и переиспользования валидаций по мере накопления графа знаний.  
- Версионность/аудит снижают трудозатраты на сопровождение и проверки, что делает расходы на поддержку предсказуемыми на горизонте жизненного цикла релизов.  

### 7.5 Основные риски
- Технологические: качество входных документов, изменчивость форматов, нагрузка на графовые запросы и вычисления ЯМ — минимизируются валидаторами, профилингом, лимитами и раздельным масштабированием.  
- Регуляторные: риск несоответствия требованиям и аудитам — закрывается чек‑листами соответствия, релизными отчётами, неизменяемыми журналами и прозрачными политиками доступа.



